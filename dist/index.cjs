function e(e,t,n){return t.reduce((e,t)=>{let r=n[t.type];return r?r(e,t):e},e)}function t(t,n,r){let{past:i,future:a}=t.history;if(i.length===0)return null;let o=i.at(-1),s=i.slice(0,-1);return{...e(n,s,r),history:{past:s,future:o?[o,...a]:a}}}function n(t,n,r){let{past:i,future:a}=t.history;if(a.length===0)return null;let o=a[0],s=a.slice(1);return{...e(n,[...i,o],r),history:{past:[...i,o],future:s}}}const r={undo:t,redo:n},i={record(e,t){let{past:n}=e;return{...e,past:[...n,t]}}},a=e=>{let{initialState:t,intentMap:n}=e,a=t,o=new Set;function s(){return a}function c(){for(let e of o)e(a)}function l(e){let t=n[e.type];if(!t)throw Error(`No intent found for command type ${e.type}`);let r=a,o=t(r,e);if(o===r)return;let s=e.meta?.recordHistory!==!1;a={...o,history:s?i.record(r.history,e):r.history},c()}function u(){let e=r.undo(a,t,n);e&&(a=e,c())}function d(){let e=r.redo(a,t,n);e&&(a=e,c())}function f(e){return o.add(e),()=>o.delete(e)}return{getState:s,dispatch:l,undo:u,redo:d,subscribe:f}},o={addNode(e,t){if(e.nodes.has(t.id))return e;let n=new Map(e.nodes);return n.set(t.id,t),{...e,nodes:n}},removeNode(e,t){if(!e.nodes.has(t))throw Error(`Node with id ${t} does not exist`);let n=new Map(e.nodes);return n.delete(t),{...e,nodes:n}},removeNodes(e,t){let n=new Map(e.nodes);return t.forEach(e=>{n.delete(e)}),{...e,nodes:n}},updateNode(e,t,n){let r=e.nodes.get(t);if(!r)throw Error(`Node with id ${t} does not exist`);let i={...r,...n},a=new Map(e.nodes);return a.set(t,i),{...e,nodes:a}}},s={insertNode(e,t,n){if(e.nodes.has(t))return e;let r=e.order.slice();return r.splice(n,0,t),{...e,order:r}},removeNode(e,t){let n=e.order.filter(e=>e!==t);return{...e,order:n}},removeNodes(e,t){if(t.length===0)return{...e,order:[...e.order]};let n=new Set(t),r=e.order.filter(e=>!n.has(e));return{...e,order:r}},reorderNode(e,t,n){let r=e.order,i=r.indexOf(t);if(i===-1)return e;let a=r.slice();a.splice(i,1);let o=Math.max(0,Math.min(n,r.length));return a.splice(o,0,t),{...e,order:a}}},c={selectNodes(e,t){return{...e,selection:{...e.selection,nodeIds:t}}},deselectNodes(e,t){let n=new Set(t),r=(e.selection.nodeIds??[]).filter(e=>!n.has(e));return{...e,selection:{...e.selection,nodeIds:r}}}},l=(e,t)=>{let{node:n,index:r,select:i}=t.payload,a=e;return a=o.addNode(a,n),a=s.insertNode(a,n.id,r??0),i&&(a=c.selectNodes(a,[n.id])),a},u=(e,t)=>{let{nodeId:n}=t.payload;if(!e.nodes.has(n))return e;let r=e;return r=o.removeNode(r,n),r=s.removeNode(r,n),r=c.deselectNodes(r,[n]),r},d=(e,t)=>{let{nodeIds:n}=t.payload;if(n.length===0)return e;let r=e;return r=o.removeNodes(r,n),r=s.removeNodes(r,n),r=c.deselectNodes(r,n),r},f=(e,t)=>{let{nodeId:n,updates:r}=t.payload;if(!e.nodes.has(n))return e;let i=e.nodes.get(n);return!i||!Object.keys(r).some(e=>i[e]!==r[e])?e:o.updateNode(e,n,r)},p=(e,t)=>{let{nodeId:n,toIndex:r}=t.payload,i=s.reorderNode(e,n,r);return i===e?e:(i=c.deselectNodes(i,[n]),i)},m=(e,t)=>{let{nodeId:n}=t.payload;return c.selectNodes(e,[n])},h=(e,t)=>{let{nodeIds:n}=t.payload;return c.deselectNodes(e,n)},g={setZoom(e,t,n,r){if(t<=0)return e;let i=e.viewport;if(r!=null&&n!=null){let i=n.x-r.x/t,a=n.y-r.y/t;return{...e,viewport:{scale:t,x:i,y:a}}}if(n){let r=t/i.scale,a=n.x-(n.x-i.x)*r,o=n.y-(n.y-i.y)*r;return{...e,viewport:{scale:t,x:a,y:o}}}return{...e,viewport:{...i,scale:t}}},pan(e,t,n){let{viewport:r}=e;return{...e,viewport:{...r,x:r.x+t,y:r.y+n}}}},_=(e,t)=>{let{scale:n,center:r,pointer:i}=t.payload;return g.setZoom(e,n,r,i)},v=(e,t)=>{let{dx:n,dy:r}=t.payload;return g.pan(e,n,r)},y={ADD_NODE:l,REMOVE_NODE:u,REMOVE_NODES:d,UPDATE_NODE:f,REORDER:p,SELECT_NODE:m,DESELECT_NODES:h,SET_ZOOM:_,PAN_VIEWPORT:v};exports.addNodeIntent=l,exports.createEditorEngine=a,exports.intentMap=y,exports.nodeOps=o,exports.orderOps=s,exports.removeNodeIntent=u,exports.reorderNodeIntent=p,exports.selectNodeIntent=m,exports.selectionOps=c,exports.updateNodeIntent=f,exports.viewportOps=g;